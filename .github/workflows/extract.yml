name: Extract yticker data from yahoo
on:
  schedule:
    # This runs at 6PM UTC
    # = 11:30 IST
    - cron: '0 18 * * *'
  push:
    # or when we update yticker.json file
    branches:
      - main
    paths:
      - '**.json'
      - '**.yml'
      - '**.php'
jobs:
  export:
    name: Extract Data
    runs-on: ubuntu-latest
    strategy:
      matrix:
        php-version: [8.3]
      fail-fast: false
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          submodules: true
          ref: ${{ github.head_ref }}
      - name: Setup PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: ${{ matrix.php-version }}
          extensions: intl #optional
          coverage: none
          ini-values: "post_max_size=256M, memory_limit=512M" #optional
      - name: Cache Composer dependencies
        uses: actions/cache@v4
        with:
          path: src/vendor
          key: ${{ runner.os }}-composer-${{ hashFiles('src/composer.lock') }}
          restore-keys: ${{ runner.os }}-composer-
      - name: Composer Dependencies
        working-directory: ./src
        run: composer install
      - name: Grab yticker data from yahoo
        working-directory: ./src
        run: php index.php
      - uses: stefanzweifel/git-auto-commit-action@v4
        id: commit
        with:
          commit_message: Update Historical Data
          commit_author: 'github-actions[bot] <github-actions[bot]@users.noreply.github.com>'